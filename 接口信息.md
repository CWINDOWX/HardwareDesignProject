# 接口信息

### 1.alu.v

```verilog
module alu(
	input wire[31:0] a,b,
	input wire[2:0] op,
	input wire hassign, //判断是不是有符号的计算
	output reg[31:0] y,
	output reg overflow,
	output wire zero
	);
```

  alu新增了一个**hassign信号**，意义在于**告诉alu这次运算是有符号运算**，**还是无符号运算**。hassign的传递路径和alu_control信号一致，由controller (maindec+aludec合并）产生，此时为hassignD，经过流水线传递到hassignE，最后将hassignE传递给alu。明确标记了是有符号运算的指令，他们的hassign应该被标记为1，其中miandec和aludec都有权标记hassign信号的值，最后的结果应当是两个值进行或运算。

  有符号运算不一定代表了一定会触发溢出异常，算术指令里，只有ADD和SUB会触发异常，所以alu里只有这两个指令会计算异常。**对于是否产生需要处理的溢出异常，应该使用hassign & overflow进行判断**。

  alu_control信号和对应的计算如下：

- 000->AND
- 001->OR
- 010->ADD
- 011->暂无功能
- 100->MULT（由hassign区分有无符号）
- 101->暂无功能
- 110->SUB
- 111->SLT （由hassign区分有无符号）

‍

### 2.controller.v

```verilog
module controller(
	input wire clk,rst,
	//decode stage
	input wire[5:0] opD,functD,
	output wire pcsrcD,branchD,equalD,jumpD,
	
	//execute stage
	input wire flushE,
	output wire memtoregE,alusrcE,
	output wire regdstE,regwriteE,	
	output wire[2:0] alucontrolE,
	output wire hassignE,    // 判断是不是有符号的计算

	//mem stage
	output wire memtoregM,memwriteM,
				regwriteM,
	//write back stage
	output wire memtoregW,regwriteW

    );
```

1. 新增了hassign信号，需要把它传递给datapath里的alu。hassign是由maindec和aludec共同产生的。

### 3.maindec.v

```verilog
module maindec(
	input wire[5:0] op,

	output wire memtoreg,memwrite,
	output wire branch,alusrc,
	output wire regdst,regwrite,
	output wire jump,
	output wire[1:0] aluop,
	output wire hassign
    );
```

1. 新增hassign信号

### 4.aludec.v

```verilog
module aludec(
	input wire[5:0] funct,
	input wire[1:0] aluop,
	output reg[2:0] alucontrol,
	output reg hassign
    );
```

1. 新增hassign信号。

### 5.datapath.v

```verilog
module datapath(
	input wire clk,rst,
	//fetch stage
	output wire[31:0] pcF,
	input wire[31:0] instrF,
	//decode stage
	input wire pcsrcD,branchD,
	input wire jumpD,
	output wire equalD,
	output wire[5:0] opD,functD,
	//execute stage
	input wire memtoregE,
	input wire alusrcE,regdstE,
	input wire regwriteE,
	input wire[2:0] alucontrolE,
	input wire hassignE,    // 判断是不是有符号的计算
	output wire flushE,
	//mem stage
	input wire memtoregM,
	input wire regwriteM,
	output wire[31:0] aluoutM,writedataM,
	input wire[31:0] readdataM,
	//writeback stage
	input wire memtoregW,
	input wire regwriteW
    );
```

1. 新增hassignE信号，由controller传递过来，再交给alu

‍
